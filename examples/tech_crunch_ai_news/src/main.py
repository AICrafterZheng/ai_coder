###This file is generated by AI from prompts/src/main.py. DO NOT MODIFY THIS FILE MANUALLY###

import requests
from bs4 import BeautifulSoup
import textwrap
from ai_coder.openai_client import call_llm

discord_webhook = "https://discord.com/api/webhooks/1234567890/ABCDEFGHIJKLMN"


def article_summary(url: str) -> str:
    """
    This function fetches a webpage and gets its summary.
    """
    response = requests.get(url)
    soup = BeautifulSoup(response.text, "html.parser")
    webpage_text = soup.get_text()
    summary = call_llm(webpage_text)
    return summary


def send_discord(message: str) -> None:
    """
    Function to send a message to a Discord webhook
    :param message: string, the message to send
    """
    data = {"content": message}
    response = requests.post(discord_webhook, data=data)
    if response.status_code == 204:
        print("Message sent successfully")
    else:
        print(f"Failed to send message, status code: {response.status_code}")


def split_messages_to_send(message, delimiter="\n") -> None:
    """
    This function splits a long message into chunks of maximum size 2000, split by the provided delimiter,
    and sends each chunk to Discord using the provided send_discord function.
    :param message: string, the message to send to discord
    :param delimiter: string, the delimiter to split the message
    """
    chunks = textwrap.wrap(
        message, 2000, break_long_words=False, replace_whitespace=False
    )
    for chunk in chunks:
        send_discord(chunk)


if __name__ == "__main__":
    print(
        article_summary(
            "https://techcrunch.com/2024/03/27/amazon-doubles-down-on-anthropic-completing-its-planned-4b-investment/"
        )
    )
